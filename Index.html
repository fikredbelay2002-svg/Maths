<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haile-Manas Academy | Simple Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        :root {
            --bg-gradient-start: #d4e9ff;
            --bg-gradient-end: #a6d0fa;
            --card-bg: rgba(255, 255, 255, 0.9);
            --text-primary: #1a3b5c;
            --text-secondary: #2c5778;
            --border-light: rgba(42, 111, 151, 0.2);
            --accent-light: #7fc3e0;
            --accent-medium: #3a8bb9;
            --accent-deep: #1a5f8a;
            --shadow: 0 20px 40px -12px rgba(0, 60, 100, 0.25);
            --error: #c44545;
        }

        body.dark {
            --bg-gradient-start: #0a2538;
            --bg-gradient-end: #0b3348;
            --card-bg: rgba(15, 35, 55, 0.9);
            --text-primary: #e2edf7;
            --text-secondary: #b5d0e5;
            --border-light: rgba(100, 170, 220, 0.2);
            --accent-light: #4f9ac7;
            --accent-medium: #2c7fb8;
            --accent-deep: #1a5f8a;
            --shadow: 0 20px 40px -12px #00000080;
        }

        body {
            background: linear-gradient(145deg, var(--bg-gradient-start), var(--bg-gradient-end));
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 0.3s;
        }

        .app {
            width: 100%;
            max-width: 900px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 48px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-light);
            overflow: hidden;
        }

        .app-header {
            padding: 24px 32px;
            border-bottom: 2px solid var(--accent-deep);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(to right, rgba(26, 95, 138, 0.05), transparent);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .school-logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
            background: white;
            border-radius: 10px;
            padding: 4px;
            box-shadow: 0 4px 12px rgba(26, 95, 138, 0.2);
        }

        .school-name h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-deep);
        }

        .school-name p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .theme-toggle {
            background: var(--card-bg);
            border: 1px solid var(--accent-medium);
            border-radius: 40px;
            padding: 4px;
            display: flex;
        }

        .theme-toggle button {
            background: transparent;
            border: none;
            padding: 6px 16px;
            border-radius: 30px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: 0.2s;
        }

        .theme-toggle button.active {
            background: var(--accent-medium);
            color: white;
        }

        .main-content {
            padding: 32px;
        }

        .calculator-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            background: var(--card-bg);
            padding: 6px;
            border-radius: 50px;
            border: 1px solid var(--border-light);
        }

        .calc-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            border-radius: 40px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: 0.2s;
        }

        .calc-tab.active {
            background: var(--accent-medium);
            color: white;
        }

        .calculator {
            display: none;
        }

        .calculator.active {
            display: block;
        }

        .sub-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 4px;
            border-radius: 40px;
            width: fit-content;
            border: 1px solid var(--border-light);
        }

        .sub-tab {
            padding: 8px 20px;
            border-radius: 40px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: 0.2s;
        }

        .sub-tab.active {
            background: var(--accent-light);
            color: var(--accent-deep);
            font-weight: 600;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .input-group {
            margin-bottom: 8px;
        }

        .input-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .input-group label i {
            color: var(--accent-medium);
            width: 20px;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-light);
            border-radius: 30px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: 0.2s;
        }

        .input-group input:focus {
            border-color: var(--accent-medium);
            outline: none;
            box-shadow: 0 0 0 3px rgba(58, 139, 185, 0.15);
        }

        .input-group input::placeholder {
            color: var(--text-secondary);
            opacity: 0.5;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin: 24px 0;
        }

        .primary-btn {
            flex: 2;
            background: var(--accent-medium);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .primary-btn:hover {
            background: var(--accent-deep);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(26, 95, 138, 0.3);
        }

        .secondary-btn {
            flex: 1;
            background: transparent;
            border: 1px solid var(--accent-medium);
            color: var(--text-primary);
            padding: 14px;
            border-radius: 40px;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
        }

        .secondary-btn:hover {
            background: var(--accent-light);
            color: var(--accent-deep);
            border-color: var(--accent-light);
        }

        .result-card {
            background: var(--card-bg);
            border-radius: 30px;
            padding: 24px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-deep);
            border: 2px dashed var(--border-light);
            margin: 20px 0;
            word-break: break-word;
        }

        .error {
            background: rgba(196, 69, 69, 0.1);
            color: var(--error);
            padding: 14px;
            border-radius: 30px;
            text-align: center;
            display: none;
            border: 1px solid var(--error);
            margin-bottom: 16px;
        }

        .chart-container {
            margin-top: 24px;
            background: var(--card-bg);
            border-radius: 30px;
            padding: 20px;
            border: 1px solid var(--border-light);
        }

        .contact-info {
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid var(--border-light);
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .contact-item i {
            color: var(--accent-medium);
            width: 24px;
        }

        .footer-note {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 16px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="app-header">
            <div class="logo-container">
                <img src="hmalogo.png" alt="Haile-Manas Academy Logo" class="school-logo" onerror="this.style.display='none'">
                <div class="school-name">
                    <h1>Haile-Manas Academy</h1>
                    <p>Grade 9 • Leave one blank</p>
                </div>
            </div>
            <div class="theme-toggle">
                <button id="lightModeBtn" class="active"><i class="fas fa-sun"></i> Light</button>
                <button id="darkModeBtn"><i class="fas fa-moon"></i> Dark</button>
            </div>
        </div>

        <div class="main-content">
            <div class="calculator-tabs">
                <div class="calc-tab active" data-calc="transport">Transport</div>
                <div class="calc-tab" data-calc="interest">Interest</div>
            </div>

            <div id="transport-calc" class="calculator active">
                <div class="input-grid">
                    <div class="input-group">
                        <label><i class="fas fa-wallet"></i> Total Fare</label>
                        <input type="number" id="total" step="any" placeholder="Leave blank">
                    </div>
                    <div class="input-group">
                        <label><i class="fas fa-play"></i> Initial Charge</label>
                        <input type="number" id="initial" step="any" placeholder="Leave blank">
                    </div>
                    <div class="input-group">
                        <label><i class="fas fa-gas-pump"></i> Rate per km</label>
                        <input type="number" id="rate" step="any" placeholder="Leave blank">
                    </div>
                    <div class="input-group">
                        <label><i class="fas fa-route"></i> Distance (km)</label>
                        <input type="number" id="distance" step="any" placeholder="Leave blank">
                    </div>
                </div>
                <div class="button-group">
                    <button class="primary-btn" onclick="calculateTransport()"><i class="fas fa-calculator"></i> Calculate</button>
                    <button class="secondary-btn" onclick="clearTransport()">Clear</button>
                </div>
                <div id="transportResult" class="result-card"></div>
                <div id="transportError" class="error"></div>
            </div>

            <div id="interest-calc" class="calculator">
                <div class="sub-tabs">
                    <div class="sub-tab active" data-sub="simple">Simple Interest</div>
                    <div class="sub-tab" data-sub="compound">Compound Interest</div>
                </div>

                <div id="simple-interest" class="calculator active">
                    <div class="input-grid">
                        <div class="input-group">
                            <label><i class="fas fa-hand-holding-usd"></i> Principal (P)</label>
                            <input type="number" id="simpleP" step="any" placeholder="Leave blank">
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-percent"></i> Rate (%)</label>
                            <input type="number" id="simpleR" step="any" placeholder="Leave blank">
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-hourglass-half"></i> Time (years)</label>
                            <input type="number" id="simpleT" step="any" placeholder="Leave blank">
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-coins"></i> Interest (I)</label>
                            <input type="number" id="simpleI" step="any" placeholder="Leave blank">
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-wallet"></i> Amount (A)</label>
                            <input type="number" id="simpleA" step="any" placeholder="Leave blank">
                        </div>
                    </div>
                    <div class="button-group">
                        <button class="primary-btn" onclick="calculateSimpleInterest()"><i class="fas fa-calculator"></i> Calculate</button>
                        <button class="secondary-btn" onclick="clearSimple()">Clear</button>
                    </div>
                    <div id="simpleResult" class="result-card"></div>
                    <div id="simpleError" class="error"></div>
                </div>

                <div id="compound-interest" class="calculator">
                    <div class="input-grid">
                        <div class="input-group">
                            <label><i class="fas fa-coins"></i> Final Amount (A)</label>
                            <input type="number" id="amount" step="any" placeholder="Leave blank">
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-hand-holding-usd"></i> Principal (P)</label>
                            <input type="number" id="principal" step="any" placeholder="Leave blank">
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-percent"></i> Rate (%)</label>
                            <input type="number" id="annualRate" step="any" placeholder="Leave blank">
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-hourglass-half"></i> Time (years)</label>
                            <input type="number" id="time" step="any" placeholder="Leave blank">
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-redo-alt"></i> Compounds/year</label>
                            <input type="number" id="compounds" step="any" min="1" placeholder="Leave blank">
                        </div>
                    </div>
                    <div class="button-group">
                        <button class="primary-btn" onclick="calculateCompoundInterest()"><i class="fas fa-calculator"></i> Calculate</button>
                        <button class="secondary-btn" onclick="swapAmountPrincipal()">Swap</button>
                        <button class="secondary-btn" onclick="clearCompound()">Clear</button>
                    </div>
                    <div id="compoundResult" class="result-card"></div>
                    <div id="compoundError" class="error"></div>
                    <div class="chart-container">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="contact-info">
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <span>fikremarkos2029@hmacademy.org</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-phone-alt"></i>
                    <span>+251 956 807 578</span>
                    
                </div>
            </div>

            <div class="footer-note">
                <i class="fas fa-lightbulb"></i> Fill all but one – we find the missing value.
            </div>
        </div>
    </div>

    <script>
        function setTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark');
                document.getElementById('lightModeBtn').classList.remove('active');
                document.getElementById('darkModeBtn').classList.add('active');
            } else {
                document.body.classList.remove('dark');
                document.getElementById('darkModeBtn').classList.remove('active');
                document.getElementById('lightModeBtn').classList.add('active');
            }
            localStorage.setItem('theme', theme);
        }
        
        document.getElementById('lightModeBtn').addEventListener('click', () => setTheme('light'));
        document.getElementById('darkModeBtn').addEventListener('click', () => setTheme('dark'));
        
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') setTheme('dark'); else setTheme('light');

        const mainTabs = document.querySelectorAll('.calc-tab');
        const transportCalc = document.getElementById('transport-calc');
        const interestCalc = document.getElementById('interest-calc');
        
        mainTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                mainTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                if (tab.dataset.calc === 'transport') {
                    transportCalc.classList.add('active');
                    interestCalc.classList.remove('active');
                } else {
                    interestCalc.classList.add('active');
                    transportCalc.classList.remove('active');
                    document.querySelector('[data-sub="simple"]').classList.add('active');
                    document.querySelector('[data-sub="compound"]').classList.remove('active');
                    document.getElementById('simple-interest').classList.add('active');
                    document.getElementById('compound-interest').classList.remove('active');
                }
            });
        });

        const subTabs = document.querySelectorAll('.sub-tab');
        const simpleCalc = document.getElementById('simple-interest');
        const compoundCalc = document.getElementById('compound-interest');
        
        subTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                subTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                if (tab.dataset.sub === 'simple') {
                    simpleCalc.classList.add('active');
                    compoundCalc.classList.remove('active');
                } else {
                    compoundCalc.classList.add('active');
                    simpleCalc.classList.remove('active');
                    setTimeout(updateChart, 100);
                }
            });
        });

        function calculateTransport() {
            const total = parseFloat(document.getElementById('total').value) || NaN;
            const initial = parseFloat(document.getElementById('initial').value) || NaN;
            const rate = parseFloat(document.getElementById('rate').value) || NaN;
            const dist = parseFloat(document.getElementById('distance').value) || NaN;
            const errorDiv = document.getElementById('transportError');
            const resultDiv = document.getElementById('transportResult');
            errorDiv.style.display = 'none';

            const fields = [total, initial, rate, dist];
            const filled = fields.filter(v => !isNaN(v));
            if (filled.length !== 3) {
                errorDiv.innerText = 'Fill three fields, leave one blank.';
                errorDiv.style.display = 'block';
                return;
            }
            for (let v of filled) if (v < 0) {
                errorDiv.innerText = 'Values cannot be negative.';
                errorDiv.style.display = 'block';
                return;
            }
            const missingIdx = fields.findIndex(isNaN);
            const missing = ['Total','Initial','Rate','Distance'][missingIdx];
            try {
                let result;
                if (missing === 'Total') result = initial + rate * dist;
                else if (missing === 'Initial') {
                    result = total - rate * dist;
                    if (result < 0) throw new Error('Initial charge negative.');
                } else if (missing === 'Rate') {
                    if (dist === 0) throw new Error('Distance cannot be zero.');
                    result = (total - initial) / dist;
                    if (result < 0) throw new Error('Rate negative.');
                } else {
                    if (rate === 0) throw new Error('Rate cannot be zero.');
                    result = (total - initial) / rate;
                    if (result < 0) throw new Error('Distance negative.');
                }
                resultDiv.innerText = `${missing} = ${result.toFixed(2)} Birr`;
            } catch (e) {
                errorDiv.innerText = e.message;
                errorDiv.style.display = 'block';
            }
        }
        
        function clearTransport() {
            document.getElementById('total').value = '';
            document.getElementById('initial').value = '';
            document.getElementById('rate').value = '';
            document.getElementById('distance').value = '';
            document.getElementById('transportResult').innerText = '';
            document.getElementById('transportError').style.display = 'none';
        }

        function calculateSimpleInterest() {
            const P = parseFloat(document.getElementById('simpleP').value) || NaN;
            const rPct = parseFloat(document.getElementById('simpleR').value) || NaN;
            const t = parseFloat(document.getElementById('simpleT').value) || NaN;
            const I = parseFloat(document.getElementById('simpleI').value) || NaN;
            const A = parseFloat(document.getElementById('simpleA').value) || NaN;
            const errorDiv = document.getElementById('simpleError');
            const resultDiv = document.getElementById('simpleResult');
            errorDiv.style.display = 'none';

            const fields = [P, rPct, t, I, A];
            const filled = fields.filter(v => !isNaN(v));
            if (filled.length !== 4) {
                errorDiv.innerText = 'Fill four fields, leave one blank.';
                errorDiv.style.display = 'block';
                return;
            }
            if (!isNaN(P) && P <= 0) { errorDiv.innerText = 'Principal must be positive.'; errorDiv.style.display = 'block'; return; }
            if (!isNaN(t) && t < 0) { errorDiv.innerText = 'Time cannot be negative.'; errorDiv.style.display = 'block'; return; }
            if (!isNaN(rPct) && rPct < 0) { errorDiv.innerText = 'Rate cannot be negative.'; errorDiv.style.display = 'block'; return; }

            const r = rPct / 100;
            const missingIdx = fields.findIndex(isNaN);
            const missing = ['Principal','Rate','Time','Interest','Amount'][missingIdx];

            try {
                let result;
                if (missing === 'Principal') {
                    if (!isNaN(I) && !isNaN(r) && !isNaN(t)) result = I / (r * t);
                    else if (!isNaN(A) && !isNaN(r) && !isNaN(t)) result = A / (1 + r * t);
                    else throw new Error('Cannot calculate Principal.');
                } else if (missing === 'Rate') {
                    if (!isNaN(P) && !isNaN(t) && !isNaN(I)) result = I / (P * t) * 100;
                    else if (!isNaN(P) && !isNaN(t) && !isNaN(A)) result = (A/P - 1) / t * 100;
                    else throw new Error('Cannot calculate Rate.');
                } else if (missing === 'Time') {
                    if (!isNaN(P) && !isNaN(r) && !isNaN(I)) result = I / (P * r);
                    else if (!isNaN(P) && !isNaN(r) && !isNaN(A)) result = (A/P - 1) / r;
                    else throw new Error('Cannot calculate Time.');
                } else if (missing === 'Interest') {
                    if (!isNaN(P) && !isNaN(r) && !isNaN(t)) result = P * r * t;
                    else if (!isNaN(A) && !isNaN(P)) result = A - P;
                    else throw new Error('Cannot calculate Interest.');
                } else {
                    if (!isNaN(P) && !isNaN(r) && !isNaN(t)) result = P * (1 + r * t);
                    else if (!isNaN(P) && !isNaN(I)) result = P + I;
                    else throw new Error('Cannot calculate Amount.');
                }
                if (result < 0) throw new Error('Calculated value negative.');
                const resultText = `${missing} = ${result.toFixed(2)}${missing==='Rate'?'%':''}`;
                resultDiv.innerText = resultText;
            } catch (e) {
                errorDiv.innerText = e.message;
                errorDiv.style.display = 'block';
            }
        }
        
        function clearSimple() {
            document.getElementById('simpleP').value = '';
            document.getElementById('simpleR').value = '';
            document.getElementById('simpleT').value = '';
            document.getElementById('simpleI').value = '';
            document.getElementById('simpleA').value = '';
            document.getElementById('simpleResult').innerText = '';
            document.getElementById('simpleError').style.display = 'none';
        }

        let chart;
        
        function calculateCompoundInterest() {
            const amount = parseFloat(document.getElementById('amount').value) || NaN;
            const principal = parseFloat(document.getElementById('principal').value) || NaN;
            const ratePercent = parseFloat(document.getElementById('annualRate').value) || NaN;
            const time = parseFloat(document.getElementById('time').value) || NaN;
            const compounds = parseFloat(document.getElementById('compounds').value) || NaN;
            const errorDiv = document.getElementById('compoundError');
            const resultDiv = document.getElementById('compoundResult');
            errorDiv.style.display = 'none';

            const fields = [amount, principal, ratePercent, time, compounds];
            const filled = fields.filter(v => !isNaN(v));
            if (filled.length !== 4) {
                errorDiv.innerText = 'Fill four fields, leave one blank.';
                errorDiv.style.display = 'block';
                return;
            }
            if (!isNaN(principal) && principal <= 0) { errorDiv.innerText = 'Principal must be positive.'; errorDiv.style.display = 'block'; return; }
            if (!isNaN(time) && time < 0) { errorDiv.innerText = 'Time cannot be negative.'; errorDiv.style.display = 'block'; return; }
            if (!isNaN(compounds) && compounds <= 0) { errorDiv.innerText = 'Compounds/year > 0.'; errorDiv.style.display = 'block'; return; }

            const r = ratePercent / 100;
            const missingIdx = fields.findIndex(isNaN);
            const missing = ['Amount','Principal','Rate','Time','Compounds'][missingIdx];

            try {
                let result;
                if (missing === 'Amount') {
                    result = principal * Math.pow(1 + r / compounds, compounds * time);
                } else if (missing === 'Principal') {
                    result = amount / Math.pow(1 + r / compounds, compounds * time);
                } else if (missing === 'Rate') {
                    if (principal <= 0 || time <= 0) throw new Error('Principal & time positive.');
                    const base = amount / principal;
                    if (base <= 0) throw new Error('Amount/Principal positive.');
                    result = compounds * (Math.pow(base, 1 / (compounds * time)) - 1);
                } else if (missing === 'Time') {
                    if (principal <= 0) throw new Error('Principal positive.');
                    if (r <= -1 || (1 + r/compounds) <= 0) throw new Error('Invalid rate.');
                    const ratio = amount / principal;
                    if (ratio <= 0) throw new Error('Amount/Principal positive.');
                    result = Math.log(ratio) / (compounds * Math.log(1 + r / compounds));
                } else {
                    if (principal <= 0 || time <= 0) throw new Error('Principal & time positive.');
                    if (r <= -1) throw new Error('Rate > -100%.');
                    const target = amount / principal;
                    if (target <= 0) throw new Error('Amount/Principal positive.');
                    const f = (x) => Math.pow(1 + r/x, x * time) - target;
                    let low = 1, high = 1e6;
                    while (f(low) * f(high) > 0 && high < 1e12) high *= 2;
                    let mid;
                    for (let i = 0; i < 200; i++) {
                        mid = (low + high) / 2;
                        if (Math.abs(f(mid)) < 1e-12) break;
                        if (f(low) * f(mid) <= 0) high = mid;
                        else low = mid;
                    }
                    result = mid;
                }
                const resultText = missing === 'Rate' ? `Annual Rate = ${(result*100).toFixed(4)}%` :
                                 missing === 'Compounds' ? `Compounds/year ≈ ${result.toFixed(4)}` :
                                 `${missing} = ${result.toFixed(2)}`;
                resultDiv.innerText = resultText;
                updateChart();
            } catch (e) {
                errorDiv.innerText = e.message;
                errorDiv.style.display = 'block';
            }
        }
        
        function swapAmountPrincipal() {
            const a = document.getElementById('amount').value;
            const p = document.getElementById('principal').value;
            document.getElementById('amount').value = p;
            document.getElementById('principal').value = a;
            calculateCompoundInterest();
        }
        
        function clearCompound() {
            document.getElementById('amount').value = '';
            document.getElementById('principal').value = '';
            document.getElementById('annualRate').value = '';
            document.getElementById('time').value = '';
            document.getElementById('compounds').value = '';
            document.getElementById('compoundResult').innerText = '';
            document.getElementById('compoundError').style.display = 'none';
            if (chart) chart.destroy();
        }
        
        function updateChart() {
            const P = parseFloat(document.getElementById('principal').value);
            const rPct = parseFloat(document.getElementById('annualRate').value);
            const t = parseFloat(document.getElementById('time').value);
            const n = parseFloat(document.getElementById('compounds').value);
            if ([P, rPct, t, n].some(isNaN) || n <= 0) return;
            const r = rPct / 100;
            const years = Math.min(Math.ceil(t), 20);
            const labels = [], amounts = [];
            for (let y = 0; y <= years; y++) {
                labels.push(y);
                amounts.push(P * Math.pow(1 + r / n, n * y));
            }
            const ctx = document.getElementById('growthChart').getContext('2d');
            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Balance',
                        data: amounts,
                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--accent-medium').trim(),
                        backgroundColor: 'rgba(58, 139, 185, 0.1)',
                        tension: 0.2,
                        fill: true,
                        pointBackgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--accent-deep').trim(),
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: false } }
                }
            });
        }

        window.onload = function() {
            const fields = ['total','initial','rate','distance','simpleP','simpleR','simpleT','simpleI','simpleA','amount','principal','annualRate','time','compounds'];
            fields.forEach(id => {
                const saved = localStorage.getItem(id);
                if (saved !== null) document.getElementById(id).value = saved;
            });
            if (document.getElementById('compound-interest').classList.contains('active')) updateChart();
        };
        
        window.onbeforeunload = function() {
            const fields = ['total','initial','rate','distance','simpleP','simpleR','simpleT','simpleI','simpleA','amount','principal','annualRate','time','compounds'];
            fields.forEach(id => localStorage.setItem(id, document.getElementById(id).value));
        };
        
        document.querySelectorAll('input').forEach(inp => inp.addEventListener('input', () => {
            localStorage.setItem(inp.id, inp.value);
        }));
    </script>
</body>
</html>
